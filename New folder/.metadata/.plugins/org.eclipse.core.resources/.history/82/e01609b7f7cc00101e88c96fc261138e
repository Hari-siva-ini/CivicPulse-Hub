package com.example.backend.Controller;

import java.util.Map;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import io.swagger.v3.oas.models.media.MediaType;
import jakarta.security.auth.message.callback.PrivateKeyCallback.Request;
import okhttp3.OkHttpClient;
import okhttp3.Response;

@RestController
@RequestMapping("/api/chat")
@CrossOrigin(origins = "http://localhost:3000")
public class ChatController {

    private final String API_KEY = "YOUR_GEMINI_API_KEY";

    @PostMapping("/ask")
    public ResponseEntity<?> askAI(@RequestBody Map<String, String> body) {
        String userMessage = body.get("message");

        try {
            OkHttpClient client = new OkHttpClient();

            String json = "{\n" +
                    "  \"contents\": [{\n" +
                    "    \"parts\": [{ \"text\": \"" + userMessage + "\" }]\n" +
                    "  }]\n" +
                    "}";

            Request request = new Request.Builder()
                    .url("https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=" + API_KEY)
                    .post(RequestBody.create(json, MediaType.get("application/json")))
                    .build();

            Response response = client.newCall(request).execute();
            String responseBody = response.body().string();

            return ResponseEntity.ok(responseBody);

        } catch (Exception e) {
            e.printStackTrace();
            return ResponseEntity.status(500).body("AI service error: " + e.getMessage());
        }
    }
}
